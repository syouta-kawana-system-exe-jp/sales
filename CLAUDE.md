# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## リポジトリ概要

社内の営業活動に関するドキュメント管理リポジトリ。複数顧客向けのIT提案書・見積書と、社内ナレッジベースで構成される。ソフトウェア開発プロジェクトではない。

## ディレクトリ構成

```
sales/
├── 00_inbox/                     ← ファイル投入口（ここに置かれたファイルを仕分ける）
├── 01_clients/
│   ├── 01_idemitsu/              — 出光興産（既存顧客）
│   │   ├── 01_proposals/         — 提案書(.pptx)
│   │   ├── 02_estimates/         — 見積書(.pptx/.xlsx)
│   │   └── 03_management/        — 実行予算・検証シート・PJ管理資料(.xlsx)
│   └── NN_<顧客名>/              — 新規顧客は連番で自動作成
│       ├── 01_proposals/
│       ├── 02_estimates/
│       └── 03_management/
├── 02_knowledge/
│   ├── 01_proposal_cases/        — 案件カタログ・提案書テンプレート・事例集
│   ├── 02_training/              — アーキテクト教育・見積提案教育
│   ├── 03_standards/             — PMBOK、非機能要求グレード
│   ├── 04_introductions/         — 会社紹介・サービス紹介・技術紹介資料
│   ├── 05_reviews/               — レビューのナレッジ化（振り返り・改善点）
│   └── 06_estimate_patterns/     — 見積パターン集・類似案件比較
├── .github/workflows/
│   └── analyze-inbox.yml         — GitHub Actions 自動分析ワークフロー
├── .devcontainer/
│   ├── devcontainer.json         — Codespaces / Dev Container 設定
│   └── README.md                 — Codespaces セットアップガイド
├── scripts/
│   ├── extract_text.py           — pptx/xlsx/pdf テキスト抽出スクリプト
│   └── prompts/
│       ├── analyze-file.txt      — フル分析プロンプト（分類+移動+ナレッジ更新）
│       └── classify-only.txt     — ドライラン用分類専用プロンプト
└── CLAUDE.md
```

---

## 仕分けルール（00_inbox/ → 各フォルダー）

ユーザーが `00_inbox/` にファイルを置いた場合、**仕分け + ナレッジ更新** をセットで行う。

### Step 1: ファイル分類

#### 判定の優先順位（上から順に判定、先にマッチした方を優先）

| 優先度 | キーワード | 分類先 |
|---|---|---|
| 1 | 検証シート・実行予算・レビュー記録・計画書・報告書・WBS・スケジュール・納品物一覧・要員計画・案件 | `01_clients/<顧客名>/03_management/` |
| 2 | 提案・ご提案・提案書・説明・構想書・について・キックオフ | `01_clients/<顧客名>/01_proposals/` |
| 3 | 見積・お見積・御見積・概算・工数算出・費用・粗利 | `01_clients/<顧客名>/02_estimates/` |
| 4 | 紹介・会社案内・サービス・導入・AI技術 | `02_knowledge/04_introductions/` |
| 5 | 教育・研修・トレーニング | `02_knowledge/02_training/` |
| 6 | PMBOK・規格・ガイド | `02_knowledge/03_standards/` |

**重要:** 「見積もり検証シート」「レビュー記録」など管理系キーワードが含まれる場合は、「見積」キーワードより管理を優先する。

#### 顧客の判定

テキスト内容・ファイル名から顧客を特定し、該当する `01_clients/` 配下のフォルダーへ振り分ける。

**既存顧客の判定ルール:**

| 顧客フォルダー | 判定キーワード |
|---|---|
| `01_idemitsu` | 出光、IRIS、SWAN、HUB、海上入出荷、工場系、MES、IFC、PIMSDB、D&B Direct+ |

**新規顧客の場合:**

1. `01_clients/` 配下の既存フォルダーの最大連番を確認
2. 次の連番で `NN_<顧客名>/` を作成（例: `02_toyota/`）
3. 配下に `01_proposals/`, `02_estimates/`, `03_management/` を作成
4. 顧客別ナレッジファイル（案件カタログ・案件横断サマリー）も新規作成

**顧客名が不明な場合:**
- 対話時（ローカル）: ユーザーに確認してから移動
- CI 環境: `00_inbox/` に残し、コミットメッセージで顧客不明を報告

#### 判定できない場合

ファイル名・内容から分類先が判断できない場合:
- 対話時（ローカル）: ユーザーに確認してから移動
- CI 環境: `00_inbox/` に残し、コミットメッセージで判定不能を報告

### Step 2: ナレッジ自動更新（仕分け後に必ず実行）

仕分け完了後、以下のナレッジ更新を行う。

#### A. 案件カタログ更新

顧客別の案件カタログに新規ファイルの情報を追記する。

- 出光興産: `02_knowledge/01_proposal_cases/案件カタログ_出光興産.md`
- 他の顧客: `02_knowledge/01_proposal_cases/案件カタログ_<顧客名>.md`（なければ新規作成）
- 既存案件 → 該当セクションにファイルを追加
- 新規案件 → 新しいセクションを作成（案件名、ファイル一覧、技術スタック）

#### B. 見積パターン更新

新しい見積書が追加された場合、`02_knowledge/06_estimate_patterns/見積パターン集.md` の該当パターンにケースを追加。

#### C. ユーザー作成ドキュメントのナレッジ化

ユーザーが「自分で作成した」と申告したファイルは、追加で以下を行う:

1. **ファイルの内容をユーザーに確認**（.pptx/.xlsxは直接読めないため）
2. 提案の要点・アプローチ・技術選定理由をヒアリング
3. `02_knowledge/01_proposal_cases/` に案件別の要約Markdownを作成

要約Markdownのフォーマット:
```markdown
# <案件名> 提案・見積ナレッジ

## 基本情報
| 項目 | 内容 |
|---|---|
| 案件名 | |
| 顧客 | |
| 作成日 | |
| 対象ファイル | |

## 提案概要
（何を・なぜ・どうやって提案したか）

## 技術構成
（採用技術とその選定理由）

## 見積の勘所
（工数の根拠、リスクバッファの考え方、注意点）

## 横展開ポイント
（他案件に活かせる要素）

## 反省・改善点
（次回以降に活かすこと）
```

### Step 3: レビューナレッジ化

ユーザーがレビューを実施した際は:

1. `02_knowledge/05_reviews/レビューテンプレート.md` をコピー
2. レビュー内容を記録
3. ファイル名: `YYYYMMDD_<案件名>_レビュー.md`
4. 見積パターン集にも学びを反映

---

## ナレッジベース詳細

ナレッジファイルは顧客別に `_<顧客名>.md` のサフィックスで管理する。新規顧客の場合は同じフォーマットで新規作成する。

### 案件横断サマリー（トップレベル）
- **案件横断サマリー_<顧客名>.md**: 顧客別の横断分析・技術スタック一覧・見積パターン分析・ナレッジ活用ガイド
- 現在: `案件横断サマリー_出光興産.md`（16KB）

### 01_proposal_cases/
- **案件カタログ_出光興産.md**: 全39案件のファイルインデックス（自動生成・随時更新）
- **提案書ナレッジ_出光興産.md**: 19件の提案書(.pptx)からテキスト抽出した全文ナレッジ（335KB）— 生成AI/RAG、ESG/SSBJ、クラウド移行、MA-ADS Web化等
- **28期提案書**: 提案書テンプレート・事例集（約28,690行）

### 02_training/
- **28期アーキテクト教育及び見積提案教育**: 研修資料

### 03_standards/
- **PMBOK-7th-和訳軽量化**: PMBOK第7版の日本語要約版
- **非機能要求グレード利用ガイド**: 非機能要求定義のフレームワーク

### 04_introductions/
- AI技術を活用した開発体制の強化について
- Claude Code導入提案

### 05_reviews/
- **レビューテンプレート.md**: レビュー記録の雛形
- **管理資料ナレッジ_出光興産.md**: 112件の管理資料(xlsx/pptx等)からテキスト抽出した全文ナレッジ（514KB）— PJ計画書、実行予算、WBS、スケジュール、納品物一覧等
- レビュー実施ごとにMarkdownで蓄積

### 06_estimate_patterns/
- **見積パターン集.md**: 案件パターン別の見積構造・共通ポイント
- **見積書ナレッジ_出光興産.md**: 144件の見積書(pptx/xlsx)からテキスト抽出した全文ナレッジ（1.6MB）— クラウド移行見積、OS更新、DB移行、MW更新等の詳細工数

## 既存顧客 主要システム一覧

新規顧客が追加された場合、このセクションにシステム一覧を追記すること。

### 出光興産

| システム名 | 領域 |
|---|---|
| 新IRIS操業品質AP | 工場系・品質管理 |
| 販売系業務システムHUB | 販売・物流 |
| 工場系システム群 | クラウドアーキ移行 |
| 次世代研SWAN | 研究系 |
| 海上入出荷計画業務（千葉） | 物流・Azure移行 |
| MA-ADS | XenAppアプリWeb化 |
| IFC生産委託ポータル | 生産委託 |
| MES千葉/三重 | 製造実行 |
| PIMSDB | プロセス情報 |
| D&B Direct+ | 企業情報 |

## 分析パイプライン

Claude MAX（OAuth 認証）を使用するため、分析はローカル環境で実行する。

### フロー

```
方法1: inbox.sh で一括実行（推奨）
  ./scripts/inbox.sh ファイル.pptx
    ↓ ファイルを 00_inbox/ にコピー
    ↓ テキスト抽出（extract_text.py）
    ↓ Claude 分析（分類 → git mv → ナレッジ更新）
    ↓ auto-commit & push

方法2: 手動で段階実行
  cp ファイル.pptx 00_inbox/
  ./scripts/analyze-local.sh            # フル分析
  ./scripts/analyze-local.sh --dry-run  # 分類のみ確認
```

### スクリプト一覧

| スクリプト | 用途 |
|---|---|
| `scripts/inbox.sh` | ファイル追加 → 分析 → commit → push を1コマンドで実行 |
| `scripts/analyze-local.sh` | 00_inbox/ 内のファイルを分析（フル / ドライラン） |
| `scripts/extract_text.py` | pptx/xlsx/pdf からテキスト抽出 → JSON |

### オプション

| オプション | 説明 |
|---|---|
| `--dry-run` | 分類のみ確認（ファイル移動・ナレッジ更新なし） |
| `--model opus` | Opus で高品質分析（デフォルト: Sonnet） |
| `--model sonnet` | Sonnet で高速・低コスト分析 |

### GitHub Actions

`00_inbox/**` への push 時に未分析ファイルの検出・通知のみ行う（Claude 分析は行わない）。
API Key を取得した場合は `.github/workflows/analyze-with-api.yml.example` を参照。

### テキスト抽出スクリプト (`scripts/extract_text.py`)

| 形式 | ライブラリ | 抽出内容 |
|---|---|---|
| .pptx | python-pptx | スライド・テキストフレーム・テーブル |
| .xlsx / .xlsm | openpyxl | シート・セル（500行上限） |
| .pdf | PyPDF2 | ページテキスト |

出力: `/tmp/extracted_texts.json`（構造化JSON）

### コスト目安

| シナリオ | モデル | 概算コスト/ファイル |
|---|---|---|
| 小さい pptx (4スライド) | Sonnet | ~$0.02 |
| 大きい xlsx (13シート) | Sonnet | ~$0.12 |
| 深い分析 + クロスリファレンス | Opus | ~$1.00 |

---

## 作業時の注意

- すべてのドキュメント・出力・コミットメッセージは日本語で記述すること
- .pptx/.xlsxファイルはバイナリのため直接編集不可。**ただし、ナレッジMarkdownに全文抽出済み**なので、まずナレッジファイルを参照すること
- ナレッジベースのMarkdownファイルは大容量（最大1.6MB）のため、読み込み時はoffset/limitパラメータの活用を推奨
- Python (`python-pptx`, `openpyxl`) のパスは `C:\Users\syouta.kawana\AppData\Local\Programs\Python\Python313\python.exe` を使うこと（WindowsApps版は不可）

## ナレッジ検索の手順

1. **まず `案件横断サマリー_<顧客名>.md`** を読む → 全体像把握
2. **案件名で検索** → `案件カタログ_<顧客名>.md` でファイル特定
3. **提案内容を確認** → `提案書ナレッジ_<顧客名>.md` で該当箇所をGrep
4. **見積詳細を確認** → `見積書ナレッジ_<顧客名>.md` で工数・金額を確認
5. **管理情報を確認** → `管理資料ナレッジ_<顧客名>.md` でPJ計画・予算を確認
6. **顧客横断で比較** → 複数顧客のナレッジを Grep で横断検索
