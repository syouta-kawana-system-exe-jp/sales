name: Inbox File Detection

# Claude MAX 環境のため、CI での Claude 分析は行わない。
# このワークフローは新ファイルの検出とテキスト抽出のみ実行し、
# 分析はローカルの ./scripts/inbox.sh で行う。
#
# API Key を取得した場合は analyze-with-api.yml.example を参照。

on:
  push:
    paths:
      - '00_inbox/**'

permissions:
  contents: read

jobs:
  check-inbox:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Detect new files in 00_inbox
        run: |
          FILES=$(git diff --name-only --diff-filter=AM HEAD~1 HEAD -- '00_inbox/' | grep -v '.gitkeep' || true)

          if [ -z "$FILES" ]; then
            echo "::notice::00_inbox/ に新規ファイルなし"
          else
            echo "::warning::未分析ファイルが 00_inbox/ にあります。ローカルで ./scripts/inbox.sh を実行してください。"
            echo ""
            echo "検出されたファイル:"
            echo "$FILES"
            echo ""
            echo "分析コマンド:"
            echo "  ./scripts/analyze-local.sh"
          fi
